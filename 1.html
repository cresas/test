<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basit Dalga Simülatörü</title>

    <style>
        /* CSS'te herhangi bir değişiklik yok, önceki haliyle aynı */
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .top-container,
        main,
        footer,
        .bottom-controls {
            width: 100%;
            max-width: 800px;
        }

        .top-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 5px;
            padding: 10px 15px;
            background-color: #a7f0e3;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #75e0cb;
        }

        .bottom-controls {
            margin-top: 10px;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            padding: 10px 15px;
            background-color: #a7f0e3;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
            border: 1px solid #75e0cb;
        }

        .timer-display {
            font-size: 2.2em;
            font-weight: bold;
            color: #333;
        }

        .top-controls button {
            padding: 5px 10px;
            background-color: #eee;
            border: 2px solid #aaa;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            flex-shrink: 0;
            margin-left: 10px;
        }

        main {
            position: relative;
        }

        #wave-canvas {
            background-color: #e0f7fa;
            border: 1px solid #ccc;
            background-image: 
                linear-gradient(to right, #b2ebf2 1px, transparent 1px),
                linear-gradient(to bottom, #b2ebf2 1px, transparent 1px);
            background-size: 20px 20px;
            display: block;
            width: 100%;
        }

        footer {
            display: flex;
            margin-top: 10px;
        }

        .data-panel {
            background-color: #00bcd4;
            color: black;
            padding: 10px 15px;
            border-radius: 5px;
            flex: 1;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            font-size: 0.9em;
        }

        .slider-panel {
            background-color: #757575;
            padding: 10px 15px;
            border-radius: 5px;
            flex: 2;
            margin-left: 10px;
            color: white;
        }

        .slider-group {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .slider-group label {
            min-width: 90px;
            font-size: 0.9em;
        }

        .slider-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .slider-wrapper input[type="range"] {
            width: 100%;
        }
        
        .slider-value-display {
            background-color: #00bcd4;
            color: black;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            font-size: 0.9em;
            padding: 3px 8px;
            border-radius: 4px;
            margin-top: 5px;
            min-width: 90px;
            text-align: center;
        }

        .bottom-controls button {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background-color: #f38a1a;
            color: black;
            font-weight: bold;
            border: 2px solid #a05a1a;
        }

        .bottom-controls button.active {
            background-color: #ddd;
            color: black;
            border: 2px solid #555;
        }
        
        @media (max-width: 650px) {
            footer {
                flex-direction: column;
            }
            .slider-panel {
                margin-left: 0;
                margin-top: 10px;
            }
            .top-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
                border-radius: 8px 8px 0 0;
            }
            .bottom-controls {
                border-radius: 0 0 8px 8px;
            }
            .timer-display {
                font-size: 2em;
            }
        }

        @media (max-width: 480px) {
            .slider-group {
                flex-direction: column;
                align-items: stretch;
                gap: 5px;
            }
            .slider-group label {
                min-width: 0;
                text-align: center;
            }
            .slider-wrapper {
                align-items: center;
            }
            .slider-wrapper input[type="range"] {
                width: 100%;
            }
            .data-panel {
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>

    <div class="top-container">
        <div class="timer-display">
            <span id="time-display">0.00</span> saniye
        </div>
        <div class="top-controls">
            <button id="mode-toggle-button">Dalgayı parçacıklar halinde göster</button>
        </div>
    </div>

    <main>
        <canvas id="wave-canvas"></canvas>
    </main>
    
    <footer>
        <div class="data-panel">
            <p>Frekans: <span id="frequency-display">0.067</span> Hz</p>
            <p>Periyot: <span id="period-display">15</span> s</p>
            <p>Dalga Sürati: <span id="wavespeed-display">100</span> cm/s</p>
            <p>Dalga boyu: <span id="wavelength-display">1493</span> cm</p>
            <p>Genlik: <span id="amplitude-display">2.0</span> cm</p>
        </div>
        
        <div class="slider-panel">
            <div class="slider-group">
                <label for="frequency-slider">Frekans</label>
                <div class="slider-wrapper">
                    <input type="range" id="frequency-slider" min="0.01" max="1" step="0.001" value="0.067">
                    <div class="slider-value-display" id="frequency-slider-value">0.067 Hz</div>
                </div>
            </div>
            <div class="slider-group">
                <label for="wavespeed-slider">Dalga Sürati</label>
                <div class="slider-wrapper">
                    <input type="range" id="wavespeed-slider" min="10" max="500" step="10" value="100">
                    <div class="slider-value-display" id="wavespeed-slider-value">100 cm/s</div>
                </div>
            </div>
            <div class="slider-group">
                <label for="amplitude-slider">Dalga Genliği</label>
                <div class="slider-wrapper">
                    <input type="range" id="amplitude-slider" min="0.5" max="2" step="0.1" value="2.0">
                    <div class="slider-value-display" id="amplitude-slider-value">2.0 cm</div>
                </div>
            </div>
        </div>
    </footer>

    <div class="bottom-controls">
        <button id="pause-button">Duraklat</button>
        <button id="slow-motion-button">Ağır Çekim</button>
        <button id="real-time-button" class="active">Gerçek Zamanlı</button>
        <button id="fast-motion-button">Hızlı Çekim</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // 1. Elementleri Seç
            const canvas = document.getElementById('wave-canvas');
            const ctx = canvas.getContext('2d');
            const timeDisplay = document.getElementById('time-display');
            const pauseButton = document.getElementById('pause-button');
            const slowMoButton = document.getElementById('slow-motion-button');
            const realTimeButton = document.getElementById('real-time-button');
            const fastMoButton = document.getElementById('fast-motion-button');
            const modeToggleButton = document.getElementById('mode-toggle-button'); 
            const freqSlider = document.getElementById('frequency-slider');
            const speedSlider = document.getElementById('wavespeed-slider');
            const ampSlider = document.getElementById('amplitude-slider');
            const freqDisplay = document.getElementById('frequency-display');
            const periodDisplay = document.getElementById('period-display');
            const speedDisplay = document.getElementById('wavespeed-display');
            const wavelengthDisplay = document.getElementById('wavelength-display');
            const ampDisplay = document.getElementById('amplitude-display');
            const freqSliderValue = document.getElementById('frequency-slider-value');
            const speedSliderValue = document.getElementById('wavespeed-slider-value');
            const ampSliderValue = document.getElementById('amplitude-slider-value');

            // 2. State (Durum) Değişkenleri
            let state = { frequency: 0, waveSpeed: 0, amplitude: 0, period: 0, wavelength: 0 };
            let simulationSpeed = 1.0; 
            let isPaused = false;
            let elapsedTime = 0;
            let lastTimestamp = 0;
            let isParticleMode = false;
            let particles = [];
            const PARTICLE_COUNT = 500;
            
            let centerY;
            let pixelsPerCmX;
            const pixelsPerCmY = 20; // 1 kare = 20px
            const canvasWidthCm = 1000;
            const dotPositionsCm = [150, 500, 900];
            const ASPECT_RATIO = 300 / 800;

            // --- YENİ JS: Boylamsal Dalga için Yer Değiştirme Genliği ---
            // 1 kare (20px) hareket için, 20px / (800px / 1000cm) = 25cm'lik bir genliğe ihtiyacımız var.
            const LONGITUDINAL_DISPLACEMENT_AMP_CM = 25.0;
            // --- YENİ JS BİTİŞİ ---

            // 3. Event Listener'lar
            freqSlider.addEventListener('input', (e) => {
                state.frequency = parseFloat(e.target.value);
                calculateAndUpdateUI_fromInputs(); 
            });
            speedSlider.addEventListener('input', (e) => {
                state.waveSpeed = parseFloat(e.target.value);
                calculateAndUpdateUI_fromInputs();
            });
            ampSlider.addEventListener('input', (e) => {
                state.amplitude = parseFloat(e.target.value);
                initializeParticles(); 
                calculateAndUpdateUI_fromInputs();
            });

            pauseButton.addEventListener('click', () => {
                isPaused = !isPaused;
                pauseButton.textContent = isPaused ? 'Devam Et' : 'Duraklat';
                updateActiveButton(pauseButton);
            });
            slowMoButton.addEventListener('click', () => {
                simulationSpeed = 0.25; isPaused = false; updateActiveButton(slowMoButton);
            });
            realTimeButton.addEventListener('click', () => {
                simulationSpeed = 1.0; isPaused = false; updateActiveButton(realTimeButton);
            });
            fastMoButton.addEventListener('click', () => {
                simulationSpeed = 5.0; // Hız x5
                isPaused = false; 
                updateActiveButton(fastMoButton);
            });

            modeToggleButton.addEventListener('click', () => {
                isParticleMode = !isParticleMode;
                modeToggleButton.textContent = isParticleMode ? "Dalgayı ip halinde göster" : "Dalgayı parçacıklar halinde göster";
            });

            // 4. updateActiveButton Fonksiyonu
            function updateActiveButton(activeButton) {
                [pauseButton, slowMoButton, realTimeButton, fastMoButton].forEach(btn => {
                    btn.classList.remove('active');
                });
                if (activeButton !== pauseButton || isPaused) {
                    activeButton.classList.add('active');
                }
                if (!isPaused && pauseButton.textContent === 'Devam Et') {
                    pauseButton.textContent = 'Duraklat';
                }
            }

            // 5. calculateAndUpdateUI_fromInputs Fonksiyonu
            function calculateAndUpdateUI_fromInputs() {
                state.frequency = parseFloat(freqSlider.value);
                state.waveSpeed = parseFloat(speedSlider.value);
                state.amplitude = parseFloat(ampSlider.value);
                state.period = 1 / state.frequency;
                state.wavelength = state.waveSpeed / state.frequency;

                freqDisplay.textContent = state.frequency.toFixed(3); 
                periodDisplay.textContent = state.period.toFixed(0);
                speedDisplay.textContent = state.waveSpeed.toFixed(0); 
                wavelengthDisplay.textContent = state.wavelength.toFixed(0);
                ampDisplay.textContent = state.amplitude.toFixed(1); 

                freqSliderValue.textContent = `${state.frequency.toFixed(3)} Hz`;
                speedSliderValue.textContent = `${state.waveSpeed.toFixed(0)} cm/s`;
                ampSliderValue.textContent = `${state.amplitude.toFixed(1)} cm`;
            }

            // 6. initializeParticles Fonksiyonu (GÜNCELLENDİ)
            function initializeParticles() {
                particles = [];
                // Dikey dağılımı slider'daki genliğe (piksel cinsinden) göre ayarla
                const verticalSpreadPx = state.amplitude * pixelsPerCmY; 
                for (let i = 0; i < PARTICLE_COUNT; i++) {
                    particles.push({
                        x_cm: Math.random() * canvasWidthCm, 
                        // Dikey denge konumu (Boylamsal dalga için)
                        y_pixel_equilibrium: centerY + (Math.random() * 2 - 1) * verticalSpreadPx
                    });
                }
            }

            // 7. Dalga Osilasyon Fonksiyonu
            // -1 ile +1 arası bir değer döndürür
            const getWaveOscillation = (x_cm, t, k, omega) => {
                return Math.sin(omega * t - k * x_cm);
            };

            // 8. RESPONSIVE CANVAS FONKSİYONU
            function checkResize() {
                const currentWidth = canvas.clientWidth;
                if (currentWidth !== canvas.width) {
                    canvas.width = currentWidth;
                    canvas.height = currentWidth * ASPECT_RATIO;
                    centerY = canvas.height / 2;
                    pixelsPerCmX = canvas.width / canvasWidthCm;
                    initializeParticles();
                }
            }

            // 9. Ana Animasyon Döngüsü
            function draw(timestamp) {
                checkResize();

                if (!lastTimestamp) lastTimestamp = timestamp;
                const deltaTime = (timestamp - lastTimestamp) / 1000;
                lastTimestamp = timestamp;

                if (!isPaused) {
                    elapsedTime += deltaTime * simulationSpeed;
                }
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                const A_cm = state.amplitude; // Slider'daki genlik (2.0 cm)
                const k = (2 * Math.PI) / state.wavelength; 
                const omega = 2 * Math.PI * state.frequency; 

                ctx.beginPath();
                ctx.moveTo(0, centerY);
                ctx.lineTo(canvas.width, centerY);
                ctx.strokeStyle = '#333333'; 
                ctx.lineWidth = 1; 
                ctx.stroke();

                if (isParticleMode) {
                    drawParticles(A_cm, k, omega);
                } else {
                    drawRope(A_cm, k, omega);
                }
                
                timeDisplay.textContent = elapsedTime.toFixed(2);
                requestAnimationFrame(draw);
            }

            // 10. drawRope Fonksiyonu (Enine Dalga - YUKARI/AŞAĞI)
            function drawRope(A_cm, k, omega) {
                ctx.beginPath();
                ctx.strokeStyle = '#00c853'; 
                ctx.lineWidth = 5;
                
                let first_x_cm = 0 / pixelsPerCmX;
                // Dikey yer değiştirme için slider genliğini (A_cm) kullan
                let first_y_cm = getWaveOscillation(first_x_cm, elapsedTime, k, omega) * A_cm;
                ctx.moveTo(0, centerY - (first_y_cm * pixelsPerCmY));

                for (let x_pixel = 1; x_pixel <= canvas.width; x_pixel++) {
                    let x_cm = x_pixel / pixelsPerCmX; 
                    let y_cm = getWaveOscillation(x_cm, elapsedTime, k, omega) * A_cm;
                    ctx.lineTo(x_pixel, centerY - (y_cm * pixelsPerCmY));
                }
                ctx.stroke();

                ctx.fillStyle = '#d50000'; 
                for (const x_cm of dotPositionsCm) {
                    const x_pixel = x_cm * pixelsPerCmX; 
                    if (x_pixel > canvas.width) continue; 
                    let y_cm = getWaveOscillation(x_cm, elapsedTime, k, omega) * A_cm;
                    const y_pixel = centerY - (y_cm * pixelsPerCmY);
                    ctx.beginPath();
                    ctx.arc(x_pixel, y_pixel, 6, 0, 2 * Math.PI);
                    ctx.fill();
                }
            }

            // 11. drawParticles Fonksiyonu (Boylamsal Dalga - SAĞA/SOLA)
            function drawParticles(A_cm, k, omega) {
                // Yeşil parçacıkları çiz
                ctx.fillStyle = '#00c853';
                for (const p of particles) {
                    // YATAY yer değiştirme için BÜYÜK (sabit) genliği kullan
                    const x_displacement_cm = getWaveOscillation(p.x_cm, elapsedTime, k, omega) * LONGITUDINAL_DISPLACEMENT_AMP_CM;
                    const x_cm_new = p.x_cm + x_displacement_cm;
                    
                    const x_pixel = x_cm_new * pixelsPerCmX;
                    const y_pixel = p.y_pixel_equilibrium;
                    
                    ctx.beginPath();
                    ctx.arc(x_pixel, y_pixel, 3, 0, 2 * Math.PI);
                    ctx.fill();
                }

                // Kırmızı noktaları çiz
                ctx.fillStyle = '#d50000';
                for (const x_cm of dotPositionsCm) {
                    // YATAY yer değiştirme için BÜYÜK (sabit) genliği kullan
                    const x_displacement_cm = getWaveOscillation(x_cm, elapsedTime, k, omega) * LONGITUDINAL_DISPLACEMENT_AMP_CM;
                    const x_cm_new = x_cm + x_displacement_cm;
                    
                    const x_pixel = x_cm_new * pixelsPerCmX;
                    const y_pixel = centerY;
                    
                    ctx.beginPath();
                    ctx.arc(x_pixel, y_pixel, 6, 0, 2 * Math.PI);
                    ctx.fill();
                }

                // Mavi kesikli çizgiyi (Grafik) çiz
                ctx.beginPath();
                ctx.strokeStyle = '#007bff';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                
                let first_x_cm = 0 / pixelsPerCmX;
                // Grafik için slider'daki genliği (A_cm) kullan
                let first_y_displacement_cm = getWaveOscillation(first_x_cm, elapsedTime, k, omega) * A_cm;
                ctx.moveTo(0, centerY - (first_y_displacement_cm * pixelsPerCmY));

                for (let x_pixel = 1; x_pixel <= canvas.width; x_pixel++) {
                    let x_cm = x_pixel / pixelsPerCmX; 
                    let y_displacement_cm = getWaveOscillation(x_cm, elapsedTime, k, omega) * A_cm;
                    ctx.lineTo(x_pixel, centerY - (y_displacement_cm * pixelsPerCmY));
                }
                ctx.stroke();
                ctx.setLineDash([]);
            }

            // 12. Başlangıç Fonksiyonu
            function initializeApp() {
                checkResize();
                calculateAndUpdateUI_fromInputs();
                initializeParticles();
                updateActiveButton(realTimeButton);
                requestAnimationFrame(draw);
            }

            initializeApp();

        });
    </script>
</body>
</html>